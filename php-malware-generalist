#!/bin/bash

#choose y/N
yesno(){ read -p "$question " choice;case "$choice" in y|Y|yes|Yes|YES ) decision=1;; n|N|no|No|NO ) decision=0;; * ) echo "invalid" && yesno; esac; }

#b64=$(fgrep --color -HF base64_decode $x | wc -c)
hits='/tmp/hits1'

report(){
        cat $hits | sort -nr
        echo -e " " > $hits
}


terms="base64_decode|sh_decrypt_phase|eval|rot13|gzinflate|preg_replace"

echo -e "What directory would you like to scan?"
read path

for x in $(find $path -type f -name "*.php"); do b64=$(fgrep --color -HF base64_decode $x | wc -c); if [[ $b64 > "0" ]];then echo -e "$b64\t$x" >> $hits;else sleep 0; fi done

report

echo -e "\nFirst malware term search complete. Would you like to continue? y/n\n"
yesno; if [ $decision = 1 ]; then
        for x in $(find $path -type f -name "*.php"); do PHASE=$(fgrep --color -HF sh_decrypt_phase $x | wc -c); if [[ $PHASE > 0 ]]; then echo -e "$PHASE\t$x" >> $hits;else sleep 0; fi done
        report
        else
        exit 0
        fi

echo -e "\nNext malware term search complete. Would you like to continue? y/n\n"
yesno; if [ $decision = 1 ]; then
        for x in $(find $path -type f -name "*.php"); do EV=$(fgrep --color -HF "eval" $x | wc -c); if [[ $EV > 0 ]]; then echo -e "$EV\t$x" >> $hits; else sleep 0; fi done
        report
        else
        exit 0
        fi

echo -e "\nNext malware term search complete. Would you like to continue? y/n\n"
yesno; if [ $decision = 1 ]; then
        for x in $(find $path -type f -name "*.php"); do ROT=$(fgrep --color -HF rot13 $x | wc -c); if [[ $ROT > 0 ]]; then echo -e "$ROT\t$x" >> $hits; else sleep 0; fi  done
        report
        else
        exit 0
        fi

echo -e "\nNext malware term search complete. Would you like to continue? y/n\n"
yesno; if [ $decision = 1 ]; then
        for x in $(find $path -type f -name "*.php"); do GZ=$(fgrep --color -HF gzinflate $x | wc -c); if [[ $GZ > 0 ]]; then echo -e "$GZ\t$x" >> $hits;else sleep 0;fi done
        report
        else
        exit 0
        fi

echo -e "\nNext malware term search complete. Would you like to continue? y/n\n"
yesno; if [ $decision = 1 ]; then
        for x in $(find $path -type f -name "*.php"); do PREG=$(fgrep --color -HF preg_replace $x | wc -c); if [[ $PREG > 0 ]]; then echo -e "$PREG\t$x" >> $hits;else sleep 0; fi done
        report
        else
        echo -e "\n\n\nMalware terms search is complete. Review for unusual files.\n\n\n"
        fi

echo -e "\n\n\nMalware terms search is complete. Review for unusual files.\n\n\n"
